# 실행 컨텍스트 execution-context
### 자바스크립트의 동작 원리를 담고 있는 핵심 개념

모든 코드는 실행컨텍스트를 통해 실행되고 관리된다.<br>
실행컨텍스트는 식별자(함수,변수, 클래스 등)를 등록하고 관리하는 스코프(=렉시컬환경)과<br>
코드 실행 순서를 관리하는 실행컨텍스트 스택으로 이루어져 있다<br>
![image](https://user-images.githubusercontent.com/85012454/236649058-3b1cc943-08ed-4f8a-b37c-135d27bc45d5.png)

### 자바스크립트는 소스코드의 평가와 실행 과정으로 나눠 처리한다
- 소스코드 평가의 과정
  - 실행컨텍스트를 생성하고 변수, 함수 등의 선언문만 먼저 실행
  - 실행컨텍스트가 관리하는 스코프에 등록한다. ( = 렉시컬 환경의 환경레코드 ) 
- 소스코드 실행
  - 소스코드 평가 과정이 끝나면 선언문을 제외한 소스코드가 순차적으로 실행된다.<br>
    이때 코드 실행에 필요한 정보를 스코프에서 가져온다.( 변수,함수 이름 등 → 평가과정에서 등록한 것들 )<br>
    변수값 등을 할당한 결과는 다시 실행컨텍스트에 등록한다.<br>
![image](https://user-images.githubusercontent.com/85012454/236649073-31eda9dd-cf43-4de2-84bf-0676ec5ffafb.png)
<br>

### 자바스크립트는 실행 컨텍스트가 활성화되는 시점에 다음과 같은 현상이 발생한다. 
아래와 같은 현상들이 발생하면서 다른 언어에서 발견할 수 없는 특이한 현상들이 발생한다.
- 호이스팅이 발생한다(선언된 변수를 위로 끌어올린다)
- 외부 환경 정보를 구성한다
- this 값을 설정한다.
<br>


## **실행컨텍스트 스택**

```jsx
const x = 1;

function foo() {
  const y = 2;
  console.log("foo실행중");

  function bar() {
    const z = 3;
    console.log(x + y + z, "bar실행중");
  }
  bar();
}
console.log("foo함수실행전");
foo();
```

위의 코드는 전역코드와 함수코드로 이루어져 있다.<br>
전역코드를 평가하여 전역 실행컨텍스트를 생성하고 함수가 호출되면 함수코드를 평가하여 함수 실행컨텍스트를 생성한다.

- **실행순서** _(스택 = 실행컨텍스트 스택)_
  - **전역코드 평가와 실행**<br>
    전역 실행컨텍스트 생성 → 스택 푸시! → 변수x, 함수foo 실행컨텍스트 등록 ( 렉시컬환경 )→
    전역 코드가 실행 → 전역변수 x에 값이 할당, 콘솔 출력, 함수foo 호출된다
  - **foo함수 코드의 평가와 실행**<br>
    foo함수가 호출되면 전역코드 잠시 중단되고 foo함수내부 → foo함수 실행컨텍스트 생성 →
    스택 푸시→ 지역변수 y와 중첩함수 bar가 실행컨텍스트에 등록 ( 렉시컬 환경 ) →
    foo함수 코드 실행 → 변수 y에 값이 할당, 콘솔출력, bar함수 실행
  - **bar함수 코드의 평가와 실행**<br>
    foo함수를 중단, bar함수의 내부로 이동 → bar함수 실행컨텍스트 생성 → 스택에 푸시
    지역변수 z가 실행컨텍스트에 등록( 렉시컬환경 )→
    bar함수 코드 실행 → 변수z에 값이 할당, 콘솔출력 → bar함수 종료
  - foo함수 코드 복귀 (아래사진)
    bar함수 종료되면 → bar함수 실행컨텍스트를 pop해서 제거한다 → foo함수 종료
  - 전역 코드로 복귀
    foo함수 실행컨텍스트를 pop해서 제거 → 전역 실행컨텍스크도 pop제거
- _자바스크립트는 하나의 실행 컨텍스트를 갖는다 ( = 싱글스레드로 동작함을 의미한다 )<br>

**결론 : 실행 컨텍스트 스택은 코드의 실행 순서를 관리한다.**<br>
소스코드가 평가되면 실행 컨텍스트가 생성되고, 실행 컨텍스트 스택 최상위에 쌓인다.<br>
이 때 최상위에 있는 실행컨텍스트는 현재 실행중인 코드의 실행컨텍스트다.
<br>
<br>

## 렉시컬 환경 Lexical Environment

- 식별자가 선언되는 환경을 말한다.
- 렉시컬 환경은 스코프와 식별자를 관리한다.
- 스코프를 구분하여 식별자를 등록하고 관리하는 저장소 역할을 한다.

### 렉시컬 환경의 구성 컴포넌트

- 환경 레코드<br>
  스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩된 값을 관리하는 저장소이다.
- 외부 렉시컬 환경에 대한 참조 = 상위스코프<br>  
  해당 실행 컨텍스트를 생성한 상위 코드의 렉시컬 환경을 가리키고 있어서 단방향 스코프 체인을 구현한다.
